# Overview

This project is a multi-user Python automation application developed by Prince Malhotra. It leverages Selenium WebDriver for browser-based Facebook message automation, featuring a secure web interface with user authentication and personalized configurations. The core purpose is to provide a persistent, reliable, and user-friendly platform for automating Facebook messaging, including fetching messages from GitHub.

**Deployment Target:** Bot-Hosting.net
- Server: https://control.bot-hosting.net/server/f3786e69
- Host: fi3.bot-hosting.net
- Port: 22182

**Key Capabilities:**
- Multi-user authentication with secure login and signup.
- Elegant UI with gradient designs and user-specific configurations.
- Encrypted storage for sensitive data like Facebook cookies.
- Real-time automation logs and persistent state management.
- Dynamic message selection (Hindi/English/Math) from GitHub.
- Robust session persistence and immediate automation stop functionality.
- **JSON File Database** - Simple, portable file-based storage (no MongoDB needed).
- **Auto-resume automation** - Seamlessly continues when switching between deployments.
- **App Uptime Tracking** - Displays deployment uptime in sidebar showing days, hours, and minutes since deployment.

# User Preferences

Preferred communication style: Simple, everyday language (Hindi/English mix).

# System Architecture

## Core Application Structure

The application is built around a **Streamlit Web App** (`streamlit_app.py`) providing a multi-user interface with a cyberpunk neon blue theme. It includes an authentication system with password hashing, a user dashboard for configuration management, and real-time automation controls.

A **JSON File Database** (`database.py`) serves as the backend, storing user accounts, configurations, session data, automation locks, and instance registrations. It employs SHA-256 for password security, Fernet encryption for Facebook cookies, and ensures user data isolation. All data is stored in the `data/` directory.

## Bot-Hosting.net Deployment

**Configuration:**
- Host: fi3.bot-hosting.net
- Port: 22182
- Server Control Panel: https://control.bot-hosting.net/server/f3786e69

**Startup:**
- Use `start.sh` script to start the application
- Command: `./start.sh`

**Enhanced Auto-Failover System:**
- **Primary-Secondary Architecture**: Clear role separation for each deployment
- **Global Instance Heartbeat**: Every 5 seconds, instances announce their role and health
- **Instant Takeover**: 3-20 seconds when primary fails
- **Automatic Handback**: 5-15 seconds when primary returns
- TTL Alignment: Heartbeat 5s, Timeout 15s, Lock 20s

**Distributed Locking System:**
- Each deployment gets a unique 16-character Instance ID
- `acquire_automation_lock()` ensures only one instance sends messages per user
- TTL-based expiry (20 seconds) for fast automatic failover
- **Enhanced Health Monitor** (`health_monitor.py`):
  - **Global Heartbeat Worker**: Announces instance role every 5 seconds
  - **Enhanced Auto-Resume Worker**: 3-case detection system
  - Monitoring interval: 3 seconds

**Global Automation Manager:**
- Persists across Streamlit reruns using `@st.cache_resource`
- Manages automation states, threads, and monitor thread
- Singleton pattern ensures one monitor per deployment instance

## Security Architecture

-   **Password Security:** All passwords are hashed using SHA-256.
-   **Session Security:** Uses 32-byte URL-safe random tokens (generated by `secrets` module), stored as SHA-256 hashes in the database with a 7-day expiry. Sessions are browser-specific, stored in `localStorage`, and revoked on logout.
-   **Cookie Privacy:** Facebook cookies are encrypted using Fernet before storage and are never displayed in the UI.
-   **User Isolation:** User configurations and data are strictly separated by user IDs within the database.

## User Flow

1.  **New User Signup:** Users create accounts, and an empty configuration is initialized.
2.  **Login/Auto-Login:** Users log in with credentials (verified via SHA-256). A 7-day session token is created and stored in the browser's `localStorage` for persistent, browser-specific auto-login.
3.  **Configuration:** Users set Chat ID, Name Prefix, Message Delay, and optionally, Facebook Cookies. They select message type (Hindi/English) which are fetched from GitHub.
4.  **Automation:** Users start automation with saved configurations. Selenium WebDriver (headless Chrome) performs the actions, injecting cookies, navigating to chats, and sending messages with rotation and delays. Automation state and logs persist in the database and auto-resume if interrupted. A 'Stop' button immediately halts all operations.

## Browser Automation Framework

**Selenium WebDriver** with Chrome driver is used for browser automation, operating in headless mode. It handles cookie injection, message input detection, message rotation, and real-time logging.

## UI/UX Design

The UI features a **Neon Blue Hacker Theme** with cyberpunk aesthetics - fully implemented and production-ready:
- **Color Scheme:** Consistent neon blue (#00E5FF) throughout all UI elements with dark/black gradients (deep navy to pure black)
- **Typography:** Futuristic fonts (Orbitron, Rajdhani, Share Tech Mono) with neon glow text effects
- **Animations:** Matrix-style grid background, scanline effect, and ~35 floating particle effects across 3 animation layers
- **Glassmorphism:** Frosted blur effects on all cards, buttons, inputs, tabs, metrics, and UI elements
- **Neon Effects:** Pulsing glow borders, hover bloom effects, and neon outlines throughout with smooth transitions
- **Log Container:** Uses neon blue monospace styling for terminal-like automation logs
- **Vibe:** Elite hacker control system with cyberpunk/futuristic dashboard aesthetics
- **Branding:** "Prince Malhotra" with crown emoji maintained

# External Dependencies

## Core Runtime Dependencies
-   **Python 3.11**
-   **Streamlit**: Web UI framework
-   **Selenium**: Browser automation
-   **cryptography**: Fernet encryption for cookies
-   **streamlit-local-storage**: Browser `localStorage` integration

## System Dependencies (for Cloud Deployment)
-   **Chromium**: Headless browser
-   **Chromium-driver**: Selenium driver

## Database Files
-   **ACTIVE**: `database.py` - JSON file database (production-ready, currently in use)
-   `data/` directory - All user data stored here:
  - `users.json` - User accounts
  - `sessions.json` - User sessions
  - `user_configs.json` - User configurations
  - `automation_logs.json` - Automation logs
  - `automation_locks.json` - Distributed locks
  - `instances.json` - Instance registrations
-   `.encryption_key`: Fernet key for cookie encryption (auto-generated if missing)

# Recent Changes (November 2025)

- **MongoDB Removed**: Replaced with simple JSON file database for portability
- **Bot-Hosting.net Configuration**: Added config.py and start.sh for deployment
- **Port Configuration**: Changed to fi3.bot-hosting.net:22182
- **Simplified Dependencies**: Removed pymongo from requirements
